<!doctype html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>mPOS Style - Mobile Shop POS (Single HTML + Google Sheet)</title>
  <style>
    :root{
      --bg:#070b14;
      --panel:#0c1224;
      --panel2:#0e1833;
      --text:#eaf0ff;
      --muted:#9fb0cf;
      --line:rgba(255,255,255,.10);
      --brand:#38bdf8;
      --brand2:#a78bfa;
      --danger:#ff5c5c;
      --ok:#4ade80;
      --warn:#fbbf24;
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
      --r2: 14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Myanmar", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1000px 520px at 70% 10%, rgba(56,189,248,.14), transparent 60%),
        radial-gradient(900px 520px at 15% 30%, rgba(167,139,250,.14), transparent 60%),
        var(--bg);
      min-height:100vh;
    }
    a{color:inherit}
    .wrap{max-width:1180px; margin:0 auto; padding:18px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding:14px 16px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:900;
    }
    .logo{
      width:38px; height:38px; border-radius:14px;
      background: conic-gradient(from 180deg, var(--brand), var(--brand2));
      box-shadow: 0 12px 34px rgba(56,189,248,.18);
    }
    .brandText .t{font-size:15px; letter-spacing:.2px}
    .brandText .s{font-size:12px; color:var(--muted); margin-top:2px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      font-size: 13px;
      white-space:nowrap;
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{
      border:none; cursor:pointer;
      padding:10px 14px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      transition: .15s ease;
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.09);}
    .btn.primary{
      background: linear-gradient(135deg, rgba(56,189,248,.25), rgba(167,139,250,.25));
      border-color: rgba(56,189,248,.35);
    }
    .btn.danger{
      background: rgba(255,92,92,.14);
      border-color: rgba(255,92,92,.35);
      color:#ffd6d6;
    }
    .btn.ghost{background: transparent}
    .layout{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:14px;
      margin-top:14px;
    }
    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid var(--line);
    }
    .title{font-weight:900; font-size:15px}
    .sub{font-size:12px; color:var(--muted); margin-top:4px; line-height:1.4}
    .card .bd{padding:14px 16px;}
    .sidebar{
      position:sticky; top:84px;
      height: calc(100vh - 112px);
      overflow:auto;
    }
    .navGroupTitle{
      font-size:12px; color:var(--muted);
      padding:12px 12px 8px 12px;
      letter-spacing:.4px;
      text-transform: uppercase;
    }
    .navItem{
      margin:0 10px 10px 10px;
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid transparent;
      cursor:pointer;
      background: rgba(0,0,0,.18);
      display:flex; justify-content:space-between; align-items:center;
      color: var(--muted);
      transition:.12s ease;
    }
    .navItem:hover{background: rgba(255,255,255,.06); color: var(--text);}
    .navItem.active{
      background: rgba(56,189,248,.10);
      border-color: rgba(56,189,248,.35);
      color: var(--text);
    }
    .badge{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
    }

    /* Modules / widgets */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .kpiCard{grid-column: span 4;}
    .kpi{
      font-size:22px; font-weight:900; margin-top:6px;
    }
    .kpi small{font-size:12px; color:var(--muted); font-weight:700}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }
    .dot{width:8px; height:8px; border-radius:99px; background: var(--ok);}
    .dot.warn{background: var(--warn);}
    .dot.danger{background: var(--danger);}
    .field{
      width:100%;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline:none;
    }
    .field::placeholder{color: rgba(159,176,207,.72);}
    .two{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    .hint{font-size:12px; color:var(--muted); line-height:1.5}
    .msg{font-size:12px; margin-top:10px; color:var(--muted)}
    .msg.ok{color:#c7ffe0}
    .msg.err{color:#ffd6d6}
    table{width:100%; border-collapse: collapse; font-size:13px;}
    th,td{padding:10px 8px; border-bottom:1px solid var(--line); text-align:left;}
    th{color:var(--muted); font-weight:800;}
    .right{text-align:right;}
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      display:inline-flex; align-items:center; gap:8px;
      white-space:nowrap;
    }

    /* Login modal */
    .backdrop{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.62);
      z-index:50;
    }
    .backdrop.show{display:flex;}
    .modal{
      width:min(540px, 100%);
      border-radius: 20px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal .hd{padding:14px 16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center;}
    .modal .bd{padding:14px 16px;}
    .modal .ft{padding:14px 16px; border-top:1px solid var(--line); display:flex; justify-content:flex-end; gap:10px; background: rgba(0,0,0,.12);}

    /* Mobile */
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr;}
      .sidebar{position:relative; top:auto; height:auto;}
      .kpiCard{grid-column: span 6;}
    }
    @media (max-width: 560px){
      .kpiCard{grid-column: span 12;}
      .two{grid-template-columns:1fr;}
      .topbar{gap:10px}
      .pill{display:none}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div class="brandText">
          <div class="t">mPOS ‚Ä¢ Mobile Shop</div>
          <div class="s" id="routeSub">Overview</div>
        </div>
      </div>

      <div class="row">
        <span class="pill" id="sessionPill">Not logged in</span>
        <button class="btn ghost" id="btnToggleNav">‚ò∞ Menu</button>
        <button class="btn" id="btnLogin">üîê Login</button>
        <button class="btn danger" id="btnLogout" style="display:none;">‚éã Logout</button>
      </div>
    </div>

    <div class="layout">
      <!-- Sidebar -->
      <aside class="card sidebar" id="sidebar">
        <div class="hd">
          <div>
            <div class="title">Navigation</div>
            <div class="sub" id="sideSub">Choose module</div>
          </div>
          <span class="badge" id="roleBadge">Guest</span>
        </div>

        <div class="navGroupTitle">Main</div>
        <div class="navItem active" data-module="overview"><span>üìä Overview</span><span class="badge">Home</span></div>
        <div class="navItem" data-module="finance"><span>üí∞ Finance</span><span class="badge">IN/OUT</span></div>

        <div class="navGroupTitle">Shop</div>
        <div class="navItem" data-module="repair"><span>üõ†Ô∏è Repair</span><span class="badge">Jobs</span></div>
        <div class="navItem" data-module="mobile_sales"><span>üì± Mobile Sales</span><span class="badge">POS</span></div>
        <div class="navItem" data-module="accessories"><span>üéß Accessories</span><span class="badge">Cart</span></div>
        <div class="navItem" data-module="installment"><span>üßæ Installment</span><span class="badge">Due</span></div>

        <div class="bd">
          <div class="hint">
            ‚úÖ Single HTML Demo UI (mPOS style) <br/>
            ‚úÖ Finance ·Äû·Ä¨ Google Sheet ·ÄÅ·Äª·Ä≠·Äê·Ä∫·Äï·Äº·ÄÆ·Ä∏ ·Ä°·ÄÖ·ÄØ·Ä∂·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã <br/>
            (Other modules ·ÄÄ UI/demo data ·Äï·Ä´)
          </div>
        </div>
      </aside>

      <!-- Content -->
      <main id="moduleRoot"></main>
    </div>
  </div>

  <!-- Login modal -->
  <div class="backdrop" id="loginBackdrop">
    <div class="modal">
      <div class="hd">
        <div>
          <div class="title">Login</div>
          <div class="sub" id="loginSub">Login required</div>
        </div>
        <button class="btn" id="btnCloseLogin">‚úñ</button>
      </div>
      <div class="bd">
        <div class="two">
          <div>
            <div class="sub">Username</div>
            <input class="field" id="inpUser" placeholder="admin" autocomplete="username">
          </div>
          <div>
            <div class="sub">Password</div>
            <input class="field" id="inpPass" placeholder="admin123" type="password" autocomplete="current-password">
          </div>
        </div>
        <div class="msg err" id="loginErr" style="display:none;"></div>
        <div class="hint" style="margin-top:10px;">Demo: <code>admin / admin123</code></div>
      </div>
      <div class="ft">
        <button class="btn" id="btnDemoFill">‚ú® Fill demo</button>
        <button class="btn primary" id="btnDoLogin">Login</button>
      </div>
    </div>
  </div>

  <script>
    /* ===================== CONFIG ===================== */
    // üî¥ Paste your Google Apps Script Web App URL here:
    const SHEET_API_URL = "PUT_YOUR_GOOGLE_SCRIPT_URL_HERE";

    // Demo login:
    const DEMO_USER = { username: "admin", password: "admin123", role: "Owner" };

    /* ===================== State ===================== */
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    const state = {
      user: null,
      module: "overview",
      navOpen: true
    };

    function saveSession(user){ localStorage.setItem("mpos_user", JSON.stringify(user)); }
    function loadSession(){ try { return JSON.parse(localStorage.getItem("mpos_user")||"null"); } catch { return null; } }
    function clearSession(){ localStorage.removeItem("mpos_user"); }

    function setSessionUI(){
      const pill = $("#sessionPill");
      const role = $("#roleBadge");
      const sideSub = $("#sideSub");
      const btnLogin = $("#btnLogin");
      const btnLogout = $("#btnLogout");

      if(state.user){
        pill.textContent = `${state.user.username} ‚Ä¢ ${state.user.role}`;
        role.textContent = state.user.role;
        sideSub.textContent = `Welcome, ${state.user.username}`;
        btnLogin.style.display = "none";
        btnLogout.style.display = "";
      } else {
        pill.textContent = "Not logged in";
        role.textContent = "Guest";
        sideSub.textContent = "Choose module";
        btnLogin.style.display = "";
        btnLogout.style.display = "none";
      }
    }

    function setRouteSub(txt){ $("#routeSub").textContent = txt; }

    function setActiveNav(module){
      $$(".navItem").forEach(n=>n.classList.toggle("active", n.dataset.module === module));
    }

    /* ===================== Google Sheet (Finance) ===================== */
    async function saveTransactionToSheet({ type, amount, note, user }){
      if(!SHEET_API_URL || SHEET_API_URL.includes("PUT_YOUR")){
        throw new Error("SHEET_API_URL ·Äô·Äë·Ää·Ä∑·Ä∫·Äõ·Äû·Ä±·Ä∏·Äï·Ä´ (Apps Script Web App URL ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´)");
      }
      const res = await fetch(SHEET_API_URL, {
        method: "POST",
        headers: { "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify({ type, amount, note, user })
      });
      const json = await res.json().catch(()=>({ok:false, error:"Invalid JSON response"}));
      if(!res.ok || !json.ok) throw new Error(json.error || "Save failed");
      return json;
    }

    /* ===================== Modules ===================== */
    function money(n){ return new Intl.NumberFormat("en-US").format(n); }
    function todayStr(){
      return new Date().toLocaleDateString("en-GB", {year:"numeric", month:"short", day:"2-digit"});
    }
    function esc(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function modOverview(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Overview</div>
              <div class="sub">mPOS style dashboard ‚Ä¢ ${todayStr()}</div>
            </div>
            <span class="chip">üìå Demo UI</span>
          </div>
          <div class="bd">
            <div class="grid">
              <div class="card kpiCard"><div class="bd">
                <div class="sub">Today Sales</div>
                <div class="kpi">${money(1850000)} <small>MMK</small></div>
                <div class="tag"><span class="dot"></span> On track</div>
              </div></div>

              <div class="card kpiCard"><div class="bd">
                <div class="sub">Repairs In Progress</div>
                <div class="kpi">${12} <small>jobs</small></div>
                <div class="tag"><span class="dot warn"></span> Need follow-up</div>
              </div></div>

              <div class="card kpiCard"><div class="bd">
                <div class="sub">Installments Due</div>
                <div class="kpi">${3} <small>customers</small></div>
                <div class="tag"><span class="dot danger"></span> Urgent</div>
              </div></div>

              <div class="card" style="grid-column: span 12;">
                <div class="hd">
                  <div>
                    <div class="title">Recent activity</div>
                    <div class="sub">Mock records</div>
                  </div>
                  <span class="chip">üßæ Logs</span>
                </div>
                <div class="bd">
                  <table>
                    <thead><tr><th>Date</th><th>Type</th><th>Description</th><th class="right">Amount</th></tr></thead>
                    <tbody>
                      <tr><td>${todayStr()}</td><td>Sale</td><td>Accessories x2</td><td class="right">${money(25000)} MMK</td></tr>
                      <tr><td>${todayStr()}</td><td>Repair</td><td>Screen replace (A12)</td><td class="right">${money(85000)} MMK</td></tr>
                      <tr><td>${todayStr()}</td><td>Expense</td><td>Electricity</td><td class="right">${money(15000)} MMK</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function modFinance(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Finance ‚Ä¢ Income / Expense</div>
              <div class="sub">Google Sheet ·ÄÅ·Äª·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äê·Ä≤·Ä∑ module</div>
            </div>
            <span class="chip">üí∞ Sheet Sync</span>
          </div>
          <div class="bd">
            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">New transaction</div>
                  <div class="sub">Save ‚Üí Google Sheet</div>
                </div>
                <span class="chip" id="finStatusChip">Ready</span>
              </div>

              <div class="bd">
                <div class="two">
                  <div>
                    <div class="sub">Type</div>
                    <select class="field" id="finType">
                      <option>Income</option>
                      <option>Expense</option>
                    </select>
                  </div>
                  <div>
                    <div class="sub">Amount (MMK)</div>
                    <input class="field" id="finAmount" placeholder="e.g. 50000" inputmode="numeric">
                  </div>
                </div>

                <div style="margin-top:12px;">
                  <div class="sub">Note</div>
                  <input class="field" id="finNote" placeholder="e.g. Accessories sale / Rent / Phone repair fee">
                </div>

                <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;">
                  <button class="btn" id="finClearBtn">Clear</button>
                  <button class="btn primary" id="finSaveBtn">Save to Sheet</button>
                </div>

                <div class="msg" id="finMsg"></div>
                <div class="hint" style="margin-top:10px;">
                  ‚úÖ Sheet headers: Timestamp, Type, Amount, Note, User <br/>
                  ‚ö†Ô∏è Apps Script Web App ·ÄÄ·Ä≠·ÄØ "Anyone" access ·Äë·Ä¨·Ä∏·Äê·Ä¨·Äô·Äü·ÄØ·Äê·Ä∫·Äõ·ÄÑ·Ä∫ CORS/permission ·Äñ·Äº·ÄÖ·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Åã
                </div>
              </div>
            </div>

            <div style="height:12px;"></div>

            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">Quick summary (mock)</div>
                  <div class="sub">Sheet read-back ·Äô·Äú·ÄØ·Äï·Ä∫·Äû·Ä±·Ä∏ (UI only)</div>
                </div>
              </div>
              <div class="bd">
                <table>
                  <thead><tr><th>Item</th><th class="right">MMK</th></tr></thead>
                  <tbody>
                    <tr><td>Income</td><td class="right">${money(2100000)}</td></tr>
                    <tr><td>Expense</td><td class="right">${money(250000)}</td></tr>
                    <tr><td><b>Net</b></td><td class="right"><b>${money(1850000)}</b></td></tr>
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      `;
    }

    function modRepair(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Repair</div>
              <div class="sub">Intake ‚Üí Status ‚Üí Delivered (UI demo)</div>
            </div>
            <span class="chip">üõ†Ô∏è Jobs</span>
          </div>
          <div class="bd">
            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">New repair intake</div>
                  <div class="sub">Demo form</div>
                </div>
              </div>
              <div class="bd">
                <div class="two">
                  <div>
                    <div class="sub">Customer</div>
                    <input class="field" placeholder="e.g. Mg Aung">
                  </div>
                  <div>
                    <div class="sub">Phone model</div>
                    <input class="field" placeholder="e.g. Samsung A32">
                  </div>
                </div>
                <div style="margin-top:12px;">
                  <div class="sub">Issue</div>
                  <input class="field" placeholder="e.g. No power / Screen crack">
                </div>
                <div style="margin-top:12px; display:flex; justify-content:flex-end;">
                  <button class="btn primary" onclick="alert('Demo UI only (backend/database ·ÄÅ·Äª·Ä≠·Äê·Ä∫·Äô·Äæ save ·Äú·ÄØ·Äï·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫)')">Create job</button>
                </div>
              </div>
            </div>

            <div style="height:12px;"></div>

            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">Job list</div>
                  <div class="sub">Mock</div>
                </div>
              </div>
              <div class="bd">
                <table>
                  <thead><tr><th>Job</th><th>Customer</th><th>Model</th><th>Status</th><th class="right">Fee</th></tr></thead>
                  <tbody>
                    <tr><td>#R-1021</td><td>Su Su</td><td>iPhone 11</td><td><span class="tag"><span class="dot warn"></span> Waiting parts</span></td><td class="right">${money(120000)} MMK</td></tr>
                    <tr><td>#R-1022</td><td>Ko Min</td><td>OPPO A54</td><td><span class="tag"><span class="dot"></span> In progress</span></td><td class="right">${money(65000)} MMK</td></tr>
                    <tr><td>#R-1023</td><td>Hnin</td><td>Vivo Y20</td><td><span class="tag"><span class="dot danger"></span> Need call</span></td><td class="right">${money(45000)} MMK</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      `;
    }

    function modMobileSales(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Mobile Sales POS</div>
              <div class="sub">Quick sale UI demo</div>
            </div>
            <span class="chip">üì± POS</span>
          </div>
          <div class="bd">
            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">Quick invoice</div>
                  <div class="sub">Demo</div>
                </div>
              </div>
              <div class="bd">
                <div class="two">
                  <div>
                    <div class="sub">Phone model</div>
                    <input class="field" placeholder="e.g. iPhone 13 Pro Max">
                  </div>
                  <div>
                    <div class="sub">Price (MMK)</div>
                    <input class="field" placeholder="e.g. 2500000" inputmode="numeric">
                  </div>
                </div>
                <div style="margin-top:12px;">
                  <div class="sub">Customer name</div>
                  <input class="field" placeholder="e.g. Ma Thet">
                </div>
                <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;">
                  <button class="btn" onclick="window.print()">üñ®Ô∏è Print (basic)</button>
                  <button class="btn primary" onclick="alert('Demo UI only (backend/database ·ÄÅ·Äª·Ä≠·Äê·Ä∫·Äô·Äæ invoice save)')">Checkout</button>
                </div>
              </div>
            </div>

            <div style="height:12px;"></div>

            <div class="card">
              <div class="hd"><div><div class="title">Recent invoices</div><div class="sub">Mock</div></div></div>
              <div class="bd">
                <table>
                  <thead><tr><th>Invoice</th><th>Customer</th><th>Model</th><th class="right">Total</th></tr></thead>
                  <tbody>
                    <tr><td>INV-3001</td><td>Ko Aye</td><td>Samsung S21</td><td class="right">${money(1900000)} MMK</td></tr>
                    <tr><td>INV-3002</td><td>Ma Nwe</td><td>iPhone 12</td><td class="right">${money(2100000)} MMK</td></tr>
                    <tr><td>INV-3003</td><td>Su</td><td>OPPO Reno</td><td class="right">${money(1350000)} MMK</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Accessories cart (client side)
    let accCart = [];
    function modAccessories(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Accessories Sales</div>
              <div class="sub">Cart UI demo</div>
            </div>
            <span class="chip">üéß Cart</span>
          </div>
          <div class="bd">
            <div class="card">
              <div class="hd">
                <div>
                  <div class="title">Add to cart</div>
                  <div class="sub">Client-side only</div>
                </div>
                <span class="chip" id="accTotalChip">Total: 0 MMK</span>
              </div>
              <div class="bd">
                <div class="two">
                  <div>
                    <div class="sub">Item</div>
                    <input class="field" id="accItem" placeholder="e.g. Type-C Cable">
                  </div>
                  <div>
                    <div class="sub">Price (MMK)</div>
                    <input class="field" id="accPrice" placeholder="e.g. 8000" inputmode="numeric">
                  </div>
                </div>
                <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;">
                  <button class="btn" id="accAddBtn">Add</button>
                  <button class="btn primary" id="accCheckoutBtn">Checkout</button>
                </div>

                <div style="height:12px;"></div>
                <div class="card">
                  <div class="hd"><div><div class="title">Cart</div><div class="sub">Local list</div></div></div>
                  <div class="bd" id="accCartBox"></div>
                </div>

                <div class="hint" style="margin-top:10px;">
                  Receipt print + stock update ·ÄÄ·Ä≠·ÄØ backend ·ÄÅ·Äª·Ä≠·Äê·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·ÄÑ·Ä∫ mPOS ·Äú·Ä≠·ÄØ·Ä°·Äï·Äº·Ää·Ä∑·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Äú·Ä¨·Äô·Äö·Ä∫·Åã
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function bindAccessories(){
      const cartBox = $("#accCartBox");
      const totalChip = $("#accTotalChip");

      function render(){
        const total = accCart.reduce((s,x)=>s+x.price,0);
        totalChip.textContent = `Total: ${money(total)} MMK`;

        if(accCart.length===0){
          cartBox.innerHTML = `<div class="hint">Cart empty. Add items.</div>`;
          return;
        }
        cartBox.innerHTML = `
          <table>
            <thead><tr><th>Item</th><th class="right">Price</th><th class="right">Action</th></tr></thead>
            <tbody>
              ${accCart.map((it,i)=>`
                <tr>
                  <td>${esc(it.name)}</td>
                  <td class="right">${money(it.price)} MMK</td>
                  <td class="right"><button class="btn" data-rm="${i}">Remove</button></td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        `;
        cartBox.querySelectorAll("[data-rm]").forEach(b=>{
          b.addEventListener("click", ()=>{
            accCart.splice(Number(b.dataset.rm), 1);
            render();
          });
        });
      }

      $("#accAddBtn").onclick = ()=>{
        const name = ($("#accItem").value||"").trim();
        const price = Number(($("#accPrice").value||"").trim());
        if(!name || !Number.isFinite(price) || price<=0){
          alert("Valid item & price ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´");
          return;
        }
        accCart.push({name, price});
        $("#accItem").value = "";
        $("#accPrice").value = "";
        render();
      };

      $("#accCheckoutBtn").onclick = ()=>{
        const total = accCart.reduce((s,x)=>s+x.price,0);
        if(total<=0){ alert("Cart empty"); return; }
        alert(`Checkout (demo)\nTotal: ${money(total)} MMK`);
        accCart = [];
        render();
      };

      render();
    }

    function modInstallment(){
      return `
        <div class="card">
          <div class="hd">
            <div>
              <div class="title">Installment</div>
              <div class="sub">Due list UI demo</div>
            </div>
            <span class="chip">üßæ Due</span>
          </div>
          <div class="bd">
            <div class="card">
              <div class="hd"><div><div class="title">Due list</div><div class="sub">Mock</div></div></div>
              <div class="bd">
                <table>
                  <thead><tr><th>Customer</th><th>Contract</th><th>Due date</th><th class="right">Due</th></tr></thead>
                  <tbody>
                    <tr><td>Ko Zaw</td><td>INS-9901</td><td>2026-02-03</td><td class="right">${money(120000)} MMK</td></tr>
                    <tr><td>Hla Hla</td><td>INS-9902</td><td>2026-02-06</td><td class="right">${money(90000)} MMK</td></tr>
                    <tr><td>Mg Tun</td><td>INS-9903</td><td>2026-02-10</td><td class="right">${money(150000)} MMK</td></tr>
                  </tbody>
                </table>
                <div class="hint" style="margin-top:10px;">
                  Reminder SMS/Call feature ·Äë·Ää·Ä∑·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Äõ·ÄÑ·Ä∫ backend + messaging integration ·Äú·Ä≠·ÄØ·Äï·Ä´·Äô·Äö·Ä∫·Åã
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderModule(module){
      const root = $("#moduleRoot");
      state.module = module;
      setActiveNav(module);

      if(module === "overview"){
        root.innerHTML = modOverview();
        setRouteSub("Overview");
      } else if(module === "finance"){
        root.innerHTML = modFinance();
        setRouteSub("Finance");
        bindFinance();
      } else if(module === "repair"){
        root.innerHTML = modRepair();
        setRouteSub("Repair");
      } else if(module === "mobile_sales"){
        root.innerHTML = modMobileSales();
        setRouteSub("Mobile Sales");
      } else if(module === "accessories"){
        root.innerHTML = modAccessories();
        setRouteSub("Accessories");
        bindAccessories();
      } else if(module === "installment"){
        root.innerHTML = modInstallment();
        setRouteSub("Installment");
      } else {
        root.innerHTML = `<div class="card"><div class="bd">Unknown module</div></div>`;
        setRouteSub("Unknown");
      }
    }

    /* ===================== Finance bind (Sheet) ===================== */
    function bindFinance(){
      const btnSave = $("#finSaveBtn");
      const btnClear = $("#finClearBtn");
      const msg = $("#finMsg");
      const chip = $("#finStatusChip");

      btnClear.onclick = ()=>{
        $("#finAmount").value = "";
        $("#finNote").value = "";
        msg.textContent = "";
        msg.className = "msg";
        chip.textContent = "Ready";
      };

      btnSave.onclick = async (e)=>{
        e.preventDefault();
        msg.textContent = "";
        msg.className = "msg";

        const type = $("#finType").value;
        const amount = Number(($("#finAmount").value||"").trim());
        const note = ($("#finNote").value||"").trim();
        const user = state.user ? state.user.username : "guest";

        if(!Number.isFinite(amount) || amount <= 0){
          msg.textContent = "‚ùå Amount ·Äô·Äæ·Äî·Ä∫·Äô·Äæ·Äî·Ä∫·Äë·Ää·Ä∑·Ä∫·Äï·Ä´";
          msg.classList.add("err");
          return;
        }

        btnSave.disabled = true;
        btnSave.textContent = "Saving...";
        chip.textContent = "Saving...";

        try{
          await saveTransactionToSheet({ type, amount, note, user });
          msg.textContent = "‚úÖ Google Sheet ·Äë·Ä≤·Äû·Ä≠·Äô·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ";
          msg.classList.add("ok");
          chip.textContent = "Saved";
          $("#finAmount").value = "";
          $("#finNote").value = "";
        }catch(err){
          msg.textContent = "‚ùå " + err.message;
          msg.classList.add("err");
          chip.textContent = "Error";
        }finally{
          btnSave.disabled = false;
          btnSave.textContent = "Save to Sheet";
        }
      };
    }

    /* ===================== Login modal ===================== */
    function openLogin(text){
      $("#loginBackdrop").classList.add("show");
      $("#loginSub").textContent = text || "Login required";
      $("#loginErr").style.display = "none";
      setTimeout(()=>$("#inpUser").focus(), 60);
    }
    function closeLogin(){ $("#loginBackdrop").classList.remove("show"); }

    $("#btnLogin").addEventListener("click", ()=>openLogin("Please login to continue"));
    $("#btnLogout").addEventListener("click", ()=>{
      state.user = null;
      clearSession();
      setSessionUI();
      renderModule("overview");
    });
    $("#btnCloseLogin").addEventListener("click", closeLogin);
    $("#loginBackdrop").addEventListener("click", (e)=>{ if(e.target === $("#loginBackdrop")) closeLogin(); });

    $("#btnDemoFill").addEventListener("click", ()=>{
      $("#inpUser").value = DEMO_USER.username;
      $("#inpPass").value = DEMO_USER.password;
    });

    $("#btnDoLogin").addEventListener("click", ()=>{
      const u = ($("#inpUser").value||"").trim();
      const p = ($("#inpPass").value||"").trim();
      const ok = (u===DEMO_USER.username && p===DEMO_USER.password);
      if(!ok){
        const err = $("#loginErr");
        err.style.display = "";
        err.textContent = "Wrong username or password.";
        return;
      }
      state.user = { username: DEMO_USER.username, role: DEMO_USER.role };
      saveSession(state.user);
      setSessionUI();
      closeLogin();
    });

    ["#inpUser","#inpPass"].forEach(id=>{
      $(id).addEventListener("keydown", (e)=>{ if(e.key==="Enter") $("#btnDoLogin").click(); });
    });

    /* ===================== Sidebar navigation ===================== */
    $$(".navItem").forEach(n=>{
      n.addEventListener("click", ()=>{
        // Finance ·ÄÄ·Ä≠·ÄØ login ·Äô·Äú·ÄØ·Äï·Ä∫·Äò·Ä≤·Äù·ÄÑ·Ä∫·ÄÅ·Äª·ÄÑ·Ä∫·Äõ·ÄÑ·Ä∫ login ·Äï·Äº
        if(n.dataset.module === "finance" && !state.user){
          openLogin("Finance ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ login ·Äú·Ä≠·ÄØ·Äï·Ä´·Äê·Äö·Ä∫");
          return;
        }
        renderModule(n.dataset.module);
      });
    });

    // Mobile menu toggle
    $("#btnToggleNav").addEventListener("click", ()=>{
      state.navOpen = !state.navOpen;
      $("#sidebar").style.display = state.navOpen ? "" : "none";
    });

    /* ===================== Boot ===================== */
    (function init(){
      state.user = loadSession();
      setSessionUI();
      renderModule("overview");
    })();
  </script>
</body>
</html>
