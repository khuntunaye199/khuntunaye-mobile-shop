<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Phone Sales Tracker</title>
    
    <link rel="manifest" href='data:application/manifest+json,{"name":"Phone Sales Tracker","short_name":"PhoneSales","description":"Phone Sales Inventory Management App","start_url":".","display":"standalone","background_color":"#020617","theme_color":"#059669","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/1043/1043444.png","sizes":"512x512","type":"image/png","purpose":"any maskable"}]}'>
    
    <meta name="theme-color" content="#059669">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1043/1043444.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Padauk', 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; user-select: none; }
        .dark body { background-color: #020617; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.10.3",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script>
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'phone-sales-v1';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(['./'])));
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
                });
            `;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl).catch(err => console.log('SW Error:', err));
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { Plus, Search, Trash2, Smartphone, Settings, Download, X, BarChart3, Sun, Moon, Monitor, Calendar, Info, ArrowDownToLine } from 'lucide-react';
        import { BarChart, Bar, XAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';

        const INITIAL_DATA = [
          { id: '1', date: '2026-01-01', model: 'Redmi 14c', price: 400000, specs: '8/128' },
          { id: '2', date: '2026-01-02', model: 'iPhone 15 Pro', price: 3500000, specs: '256GB' }
        ];

        const App = () => {
          const [sales, setSales] = useState(() => JSON.parse(localStorage.getItem('phone_sales_data')) || INITIAL_DATA);
          const [theme, setTheme] = useState(localStorage.getItem('app_theme') || 'system');
          const [searchTerm, setSearchTerm] = useState('');
          const [isAddModalOpen, setIsAddModalOpen] = useState(false);
          const [isSettingsOpen, setIsSettingsOpen] = useState(false);
          const [isInstallModalOpen, setIsInstallModalOpen] = useState(false);
          const [newSale, setNewSale] = useState({ date: new Date().toISOString().split('T')[0], model: '', price: '', specs: '' });

          useEffect(() => {
            const root = window.document.documentElement;
            const applyTheme = (t) => {
              let actualTheme = t === 'system' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : t;
              actualTheme === 'dark' ? root.classList.add('dark') : root.classList.remove('dark');
            };
            applyTheme(theme);
            localStorage.setItem('app_theme', theme);
          }, [theme]);

          useEffect(() => { localStorage.setItem('phone_sales_data', JSON.stringify(sales)); }, [sales]);

          const stats = useMemo(() => ({
            totalRevenue: sales.reduce((sum, s) => sum + Number(s.price), 0),
            totalUnits: sales.length,
            dailyTotal: sales.filter(s => s.date === new Date().toISOString().split('T')[0]).reduce((sum, s) => sum + Number(s.price), 0)
          }), [sales]);

          const filteredSales = sales.filter(s => s.model.toLowerCase().includes(searchTerm.toLowerCase()));

          return (
            <div className="min-h-screen pb-24 bg-slate-50 dark:bg-slate-950 transition-colors text-slate-900 dark:text-slate-100">
              <header className="bg-emerald-600 dark:bg-emerald-700 text-white p-6 rounded-b-[2.5rem] shadow-xl sticky top-0 z-20">
                <div className="max-w-4xl mx-auto flex justify-between items-start">
                  <div>
                    <h1 className="text-xl font-bold">ဖုန်းအရောင်းစာရင်း</h1>
                    <p className="text-xs opacity-75">စုစုပေါင်း: {new Intl.NumberFormat().format(stats.totalRevenue)} Ks</p>
                  </div>
                  <div className="flex space-x-2">
                    <button onClick={() => setIsInstallModalOpen(true)} className="bg-white/20 p-2 rounded-xl"><ArrowDownToLine size={20} /></button>
                    <button onClick={() => setIsSettingsOpen(true)} className="bg-white/20 p-2 rounded-xl"><Settings size={20} /></button>
                  </div>
                </div>
                <div className="max-w-4xl mx-auto mt-6">
                  <button onClick={() => setIsAddModalOpen(true)} className="w-full bg-white dark:bg-slate-100 text-emerald-700 font-bold py-4 rounded-2xl shadow-lg flex items-center justify-center space-x-2">
                    <Plus size={20} /><span>စာရင်းအသစ်ထည့်မည်</span>
                  </button>
                </div>
              </header>

              <main className="max-w-4xl mx-auto p-4 space-y-4">
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-sm border dark:border-slate-800">
                    <p className="text-xs text-slate-500 uppercase">ယနေ့အရောင်း</p>
                    <h3 className="text-lg font-bold text-emerald-600">{new Intl.NumberFormat().format(stats.dailyTotal)}</h3>
                  </div>
                  <div className="bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-sm border dark:border-slate-800">
                    <p className="text-xs text-slate-500 uppercase">စုစုပေါင်း</p>
                    <h3 className="text-lg font-bold text-blue-600">{stats.totalUnits} လုံး</h3>
                  </div>
                </div>

                <div className="relative">
                  <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                  <input type="text" placeholder="ရှာဖွေရန်..." className="w-full bg-white dark:bg-slate-900 p-4 pl-12 rounded-2xl border dark:border-slate-800 outline-none" onChange={(e)=>setSearchTerm(e.target.value)} />
                </div>

                <div className="space-y-3">
                  {filteredSales.map(sale => (
                    <div key={sale.id} className="bg-white dark:bg-slate-900 p-4 rounded-2xl border dark:border-slate-800 flex justify-between items-center animate-in">
                      <div className="flex items-center space-x-3">
                        <div className="p-3 bg-slate-50 dark:bg-slate-800 rounded-xl text-emerald-600"><Smartphone size={20} /></div>
                        <div>
                          <h4 className="font-bold">{sale.model}</h4>
                          <p className="text-[10px] text-slate-400">{sale.date} • {sale.specs}</p>
                        </div>
                      </div>
                      <div className="flex items-center space-x-3">
                        <span className="font-bold text-emerald-600">{new Intl.NumberFormat().format(sale.price)}</span>
                        <button onClick={() => setSales(sales.filter(s => s.id !== sale.id))} className="text-slate-300 hover:text-red-500"><Trash2 size={18} /></button>
                      </div>
                    </div>
                  ))}
                </div>
              </main>

              {/* Add Modal */}
              {isAddModalOpen && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center">
                  <div className="bg-white dark:bg-slate-900 w-full max-w-md rounded-t-[2rem] sm:rounded-3xl p-8 animate-in">
                    <h2 className="text-xl font-bold mb-6">စာရင်းအသစ်</h2>
                    <div className="space-y-4">
                      <input type="text" placeholder="ဖုန်းမော်ဒယ်" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 border dark:border-slate-700" value={newSale.model} onChange={e=>setNewSale({...newSale, model:e.target.value})} />
                      <input type="number" placeholder="စျေးနှုန်း" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 border dark:border-slate-700" value={newSale.price} onChange={e=>setNewSale({...newSale, price:e.target.value})} />
                      <button onClick={() => {
                        if(newSale.model && newSale.price) {
                          setSales([{...newSale, id: Date.now().toString()}, ...sales]);
                          setIsAddModalOpen(false);
                          setNewSale({date: new Date().toISOString().split('T')[0], model: '', price: '', specs: ''});
                        }
                      }} className="w-full bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg">သိမ်းဆည်းမည်</button>
                      <button onClick={() => setIsAddModalOpen(false)} className="w-full text-slate-400 py-2">မလုပ်တော့ပါ</button>
                    </div>
                  </div>
                </div>
              )}

              {/* Install Info Modal */}
              {isInstallModalOpen && (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                  <div className="bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-in">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-lg font-bold">App သွင်းနည်း</h2>
                      <button onClick={() => setIsInstallModalOpen(false)}><X size={24} /></button>
                    </div>
                    <div className="text-sm space-y-3 text-slate-600 dark:text-slate-400">
                        <p><b>Android:</b> Browser ရဲ့ (⋮) ကိုနှိပ်ပြီး "Install App" ကို ရွေးပါ။</p>
                        <p><b>iPhone:</b> Safari ရဲ့ (Share) ကိုနှိပ်ပြီး "Add to Home Screen" ကို ရွေးပါ။</p>
                    </div>
                    <button onClick={() => setIsInstallModalOpen(false)} className="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl mt-6">နားလည်ပါပြီ</button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
