function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sh = ss.getSheetByName("Transactions") || ss.insertSheet("Transactions");
    if (sh.getLastRow() === 0) sh.appendRow(["Timestamp","Type","Amount","Note","User"]);

    const data = JSON.parse(e.postData.contents);
    const type = String(data.type||"").trim();
    const amount = Number(data.amount||0);
    const note = String(data.note||"").trim();
    const user = String(data.user||"web").trim();

    if (!type || !Number.isFinite(amount) || amount <= 0) {
      return ContentService.createTextOutput(JSON.stringify({ok:false,error:"Invalid data"}))
        .setMimeType(ContentService.MimeType.JSON);
    }

    sh.appendRow([new Date(), type, amount, note, user]);
    return ContentService.createTextOutput(JSON.stringify({ok:true}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({ok:false,error:String(err)}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
function doGet(){ return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON); }
